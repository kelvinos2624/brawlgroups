<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Details</title>
    <link rel="stylesheet" type="text/css" href="{% static 'styles.css' %}">
    <link rel="icon" href="{% static 'sakura_spike.webp' %}" type="image/webp">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Group Details: {{ group.name }}</h1>
    <form action="{% url 'add_player' group_id=group.id %}">
        <button type="submit">Add Player</button>
    </form>
    <form action="{% url 'index' %}" method="get">
        <button type="submit">Back to Home</button>
    </form>

    <div class="card-scroll-container-small">
      <div class="card-container-small">
        {% for player in players %}
          <div class="card-small">
              <h4>{{ player }}</h4>
              <h4>Total Trophies: {{ player.total_trophies }}</h4>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="leaderboard">
      <div class="player-info">
        <div class="player-name">Player</div>
        <div class="trophy-count">Total Trophies</div>
      </div>



      {% for player in players %}
        <div class="player-info">
          <div class="player-name">{{ player }}</div>
          <div class="trophy-count">{{ player.total_trophies }}</div>
        </div>
      {% endfor %}
    </div>
    <h2 id="selectedBrawler" display: none>Viewing: </h2>

    
    <div class="brawler-icon-scroll-container">
      <div class="brawler-icon-container">
        {% for brawler in brawlers %}
          <div class="brawler-icon" data-brawler="{{ brawler }}" style="background-image: url('{% static 'brawler_icons/' %}{{ brawler }}-icon.png');">
          <h4 style="display: none;">{{ brawler }}</h4>
          </div>
        {% endfor %}
      </div>
    </div>
    <div id="brawler-info" style="display: none;">
      <!-- Information about the selected brawler will be displayed here -->
      <h3>Selected Brawler: <span id="selected-brawler-name"></span></h3>
      {% for player in players %}
      <div class="player-info">
          <div class="player-name">{{ player }}</div>
          <div class="trophy-count" id="trophy-count-{{ player.brawl_name }}"></div>
      </div>
      {% endfor %}
  </div>
  
    <script>
      $(document).ready(function() {
        var selectedBrawler = ''; // Variable to store the currently selected brawler
        
        $('.brawler-icon-container').on('click', '.brawler-icon', function() {
          var brawlerName = $(this).data('brawler'); // Get the text content of the clicked brawler icon
          document.getElementById("selectedBrawler").innerHTML = brawlerName;
          // Toggle the visibility of the brawler-info div based on whether the clicked brawler is the same as the currently selected one
          if (selectedBrawler === brawlerName) {
            $('#brawler-info').slideUp(200); // Slide up animation to hide the brawler-info div
            selectedBrawler = ''; // Reset the selected brawler
          } else {
            $('#brawler-info').slideUp(200, function() {
              // Slide up animation to hide the brawler-info div, then update its content and slide down to reveal it
              $("#brawler-info").slideDown(200);
              $("#selected-brawler-name").text(brawlerName)
              //$('selected-brawler-name').text(brawlerName).slideDown(200);
            });
            selectedBrawler = brawlerName; // Update the selected brawler
          }
          var selectedBrawlerName = document.getElementById("selected-brawler-name").textContent;
          var brawlerTrophies = JSON.parse('{{ brawler_trophies | safe }}'); // Convert players data to JavaScript object
  
          // Iterate over each player to update trophy count
          for (const [player, trophies] of Object.entries(brawlerTrophies)) {
            var trophyCountElement = document.getElementById("trophy-count-" + player);
            trophyCountElement.textContent = brawlerTrophies[player][selectedBrawler];
          }
        });
      });
    </script>
    
    

    <button id="sortButton">Sort by Trophies</button>
    <div class="card-scroll-container">
        <div class="card-container">
          {% for player in players %}
          <div class="card">
            <div class="player-name">{{ player.name }}</div>
            <div class="player-id"><strong><h3>Player:</strong> {{ player }}</h3></div>
            <div class="player-trophies"><h4>Trophies: {{ player.total_trophies }}</h4></div>
            <div class="tilted-stats">
                <h2>Tilted Statistics</h2>
              {% for brawler, stats in player.tilted_stats.items %}
              <div><h4>{{ brawler }}: {{ stats }}</h4></div>
              {% endfor %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      <form action="{% url 'index' %}" method="get">
        <button type="submit">Back to Home</button>
    </form>
      <script>
        $(document).ready(function() {
            console.log("sort")
            var sortOrder = "highest_to_lowest";
            var isSorting = false; // Flag to track if sorting is in progress
    
            $('#sortButton').click(function() {
                // Check if sorting is already in progress
                if (isSorting) {
                    return; // Exit if sorting is already in progress
                }
                
                // Disable the button to prevent spamming
                $(this).prop('disabled', true);
    
                if (sortOrder === "highest_to_lowest") {
                    sortPlayers("highest_to_lowest");
                    sortOrder = "lowest_to_highest";
                } else {
                    sortPlayers("lowest_to_highest");
                    sortOrder = "highest_to_lowest";
                }
            });
    
            function sortPlayers(sortOption) {
                isSorting = true; // Set sorting flag to true
                
                var cards = $('.card');
                var cardsArray = $.makeArray(cards);
                cardsArray.sort(function(a, b) {
                    var trophiesA = parseInt($(a).find('.player-trophies').text().split(':')[1].trim());
                    var trophiesB = parseInt($(b).find('.player-trophies').text().split(':')[1].trim());
                    if (sortOption === "highest_to_lowest") {
                        return trophiesB - trophiesA;
                    } else {
                        return trophiesA - trophiesB;
                    }
                });
    
                // Animate card movements
                $('.card-container').empty();
                var delay = 0;
                cardsArray.forEach(function(card, index) {
                    $(card).slideUp(200).delay(delay).slideDown(200, function() {
                        // Re-enable the button after animation completes
                        if (index === cardsArray.length - 1) {
                            $('#sortButton').prop('disabled', false);
                            isSorting = false; // Set sorting flag to false
                        }
                    });
                    //delay += 100;
                    $('.card-container').append(card);
                });
            }
        });
    </script>
    

</body>
</html>


